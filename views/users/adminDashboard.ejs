<!--Views are used by the controllers to render the data-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>my profile</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;1,300;1,500;1,600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
      integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
    />

    <link rel="stylesheet" href="/public/css/userprofile.css" />
  </head>

  <body>
    <header>
      <a href="/qrs"><h2 class="logo">QRcode Generator</h2></a>

      <div>
        <a href="/api/v1/auth/logout" class="logout">LogOut</a>
      </div>
    </header>
  
    <div class="d-flex flex-column">
        <div class="addUser">
      <a href="/users/add">Add New User</a>
    </div>
      <h4 style="color:coral;">Users List:</h4>
    <table class="table w-50" style="color: azure;">
      <thead>
        <tr>
          <th >Email</th>
          <th >Role</th>
          <th >Verifed</th>
          <th>Actions</th>
        </tr>
      </thead>
      <% 
      if(user.length > 0){ 
        for(let i=0; i<user.length ;i++){
          if(!user[i].archived){
            %>
          <tr>
            <td><%= user[i].email %></td>
            <td><%= user[i].role%></td>
            <td><%= user[i].is_verified%></td>
            <td class="d-flex gap-5">
              <a href="/users/editUser?id=<%= user[i]._id %>" style="color:coral">Edit <i class="fa-solid fa-pen-to-square"></i></a>
              <a href="#" 
                dataId = "<%= user[i]._id %>"
                style="color:coral"
                class="archive-Link"><i class="fa-solid fa-box-archive"></i></a>
                </td>            
            </tr>
            <%
          }
        }
      }else{ 
        %>
      <tr>
        <td>Users not found</td>
      </tr>
      <% 
    }
    %>
    </table>
    </div>  
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const archiveLinks = document.querySelectorAll('.archive-Link');
        archiveLinks.forEach(link => {
            link.addEventListener('click',async function(event) {
                event.preventDefault();

                const userId = link.getAttribute('dataId');
                try{
                  const response = await axios.delete(`/api/v1/users/archive/${userId}`,data) ;
                  link.closest('tr').remove();
                }catch(error){
                  const errorMessage =
                  error.response && error.response.data.message
                  ? error.response.data.message
                  : "An internal server error occurred.";

                  messageBox.innerHTML = `<div class="alert alert-danger" role="alert"><i class="fas fa-times-circle"></i> ${errorMessage}
  </div>`;
                }               
            });
        });
    });
  </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
